(function(){var l=function(){$lib=AtKit.lib();var g="http://c.atbar.org/ATBar/",e="http://a.atbar.org/";/https:/.test(window.location.protocol)&&(g="https://ssl.atbar.org/c/ATBar/",e="https://ssl.atbar.org/a/");AtKit.addLocalisationMap("GB",{tts_title:"Text to Speech",tts_options:"Text to Speech Options",tts_what:"What do you want to convert to speech?",tts_selected:"Selected Text",tts_page:"Entire Page",tts_converting:"Text to Speech conversion is taking place.",tts_timeremaining:"Time Remaining:",
tts_pleasewait:"Please wait...",tts_playpause:"Play / Pause",tts_rewind:"Rewind",tts_stop:"Stop & Close TTS",tts_error:"Error",tts_overloaded:"The server is currently over capacity for text to speech conversions. Please try again later.",tts_problem:"Something went wrong while we were converting this page to speech. Please try again shortly.",tts_servererror:"An error occurred on the server. Please try again later.",tts_seconds:"seconds",tts_explain:"To use the text to speech feature with selected text, please first select the text on this page that you would like to convert. After you have done this, click the Text to Speech button, and select the 'selected text' option."});
AtKit.addLocalisationMap("ar",{tts_title:"&#1578;&#1581;&#1608;&#1610;&#1604; &#1575;&#1604;&#1606;&#1589;&#1608;&#1589; &#1575;&#1604;&#1610; &#1605;&#1575;&#1583;&#1577; &#1605;&#1587;&#1605;&#1608;&#1593;&#1577;",tts_options:"&#1582;&#1610;&#1575;&#1585;&#1575;&#1578; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;",tts_what:"&#1605;&#1575; &#1607;&#1608; &#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1584;&#1610; &#1578;&#1585;&#1610;&#1583; &#1606;&#1591;&#1602;&#1607",tts_selected:"&#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1581;&#1583;&#1583;",
tts_page:"&#1603;&#1575;&#1605;&#1604; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;",tts_converting:"&#1580;&#1575;&#1585;&#1610;&#1577; &#1581;&#1575;&#1604;&#1610;&#1575;&#1611; &#1593;&#1605;&#1604;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;",tts_timeremaining:"&#1575;&#1604;&#1608;&#1602;&#1578; &#1575;&#1604;&#1605;&#1578;&#1576;&#1602;&#1610;",tts_pleasewait:"&#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1575;&#1606;&#1578;&#1592;&#1575;&#1585;...",tts_playpause:"&#1578;&#1588;&#1594;&#1610;&#1604;/&#1573;&#1610;&#1602;&#1575;&#1601; &#1605;&#1572;&#1602;&#1578;",
tts_rewind:"&#1573;&#1593;&#1575;&#1583;&#1577;",tts_stop:"&#1573;&#1610;&#1602;&#1575;&#1601;",tts_error:"&#1582;&#1591;&#1571;",tts_overloaded:"&#1601;&#1575;&#1602;&#1578; &#1593;&#1605;&#1604;&#1610;&#1575;&#1578; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1608;&#1589; &#1587;&#1593;&#1577; &#1575;&#1604;&#1582;&#1575;&#1583;&#1605;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1604;&#1575;&#1581;&#1602;&#1575;&#1611;.",tts_problem:"&#1581;&#1583;&#1579; &#1582;&#1591;&#1571; &#1571;&#1579;&#1606;&#1575;&#1569; &#1593;&#1605;&#1604;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1576;&#1593;&#1583; &#1602;&#1604;&#1610;&#1604;.",
tts_servererror:"&#1581;&#1583;&#1579; &#1582;&#1591;&#1571; &#1601;&#1610; &#1575;&#1604;&#1582;&#1575;&#1583;&#1605;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1605;&#1581;&#1575;&#1608;&#1604;&#1577; &#1604;&#1575;&#1581;&#1602;&#1575;&#1611;.",tts_seconds:"&#1579;&#1608;&#1575;&#1606;&#1613;",tts_explain:"&#1604;&#1575;&#1587;&#1578;&#1582;&#1583;&#1575;&#1605; &#1582;&#1575;&#1589;&#1610;&#1577; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1548; &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1578;&#1581;&#1583;&#1610;&#1583; &#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1585;&#1575;&#1583; &#1578;&#1581;&#1608;&#1610;&#1604;&#1607; &#1593;&#1604;&#1609; &#1607;&#1584;&#1607; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;. &#1576;&#1593;&#1583; &#1584;&#1604;&#1603; &#1575;&#1590;&#1594;&#1591; &#1586;&#1585; &#1606;&#1591;&#1602; &#1575;&#1604;&#1606;&#1589;&#1548; &#1608;&#1575;&#1590;&#1594;&#1591; &#1582;&#1610;&#1575;&#1585; &quot;&#1575;&#1604;&#1606;&#1589; &#1575;&#1604;&#1605;&#1581;&#1583;&#1583;&quot;."});
var h={options:{title:AtKit.localisation("tts_options"),body:AtKit.localisation("tts_what")+' <br /><\!--<button id="sbStartTTS"> '+AtKit.localisation("tts_page")+'</button>--\> <button id="sbStartTTSSelection"> '+AtKit.localisation("tts_selected")+"</button>"},starting:{title:AtKit.localisation("tts_title"),body:"<center>"+AtKit.localisation("tts_converting")+" <br /><img src='"+AtKit.getPluginURL()+"images/loadingbig.gif' /><br />"+AtKit.localisation("tts_timeremaining")+": <div id='sbttstimeremaining'>...</div><br />"+
AtKit.localisation("tts_pleasewait")+" </center>"}},k={clickEnabled:!0,positition:"",playingItem:"",TTSButtons:{ttsPlay:{tooltip:AtKit.localisation("tts_playpause"),icon:AtKit.getPluginURL()+"images/control-pause.png",fn:function(){($lib.browser=="msie"?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("play")}},ttsRewind:{tooltip:AtKit.localisation("tts_rewind"),icon:AtKit.getPluginURL()+"images/control-stop-180.png",fn:function(){var a=AtKit.get("TTS_position")-
2;a<0&&(a=0);($lib.browser=="msie"?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("seek",a)}},ttsStop:{tooltip:AtKit.localisation("tts_stop"),icon:AtKit.getPluginURL()+"images/control-stop-square.png",fn:function(){($lib.browser=="msie"?swfobject.getObjectById(AtKit.get("ATAudioPlayerID")):window.document.audioe).sendEvent("stop");AtKit.call("TTSRemoveControlBox")}}}};AtKit.addFn("getSelectedTextTTS",function(a){var c=AtKit.call("getSelectedTextInElement");
if(c==null)c="",document.selection&&document.selection.type!="Control"&&document.selection.createRange().text!=""?c=document.selection.createRange().text:window.getSelection&&window.getSelection().toString()!=""?c=window.getSelection().toString():document.getSelection&&(c=document.getSelection());return a===!0?String(c).replace(/([\s]+)/ig,""):String(c)});AtKit.addFn("getSelectedTextInElement",function(){var a=document.activeElement;return("selectionStart"in a&&function(){return a.value.substr(a.selectionStart,
a.selectionEnd-a.selectionStart)}||document.selection&&function(){var c=$lib(a).prop("nodeName");if(c!="input"&&c!="textarea")return null;a.focus();c=document.selection.createRange();if(c===null)return null;var d=a.createTextRange(),f=d.duplicate();d.moveToBookmark(c.getBookmark());f.setEndPoint("EndToStart",d);return c.text}||function(){return null})()});AtKit.addFn("b64",function(a){for(var c="",d,f,e,g,h,i,j=0,a=AtKit.call("utf8_encode",a);j<a.length;)d=a.charCodeAt(j++),f=a.charCodeAt(j++),e=
a.charCodeAt(j++),g=d>>2,d=(d&3)<<4|f>>4,h=(f&15)<<2|e>>6,i=e&63,isNaN(f)?h=i=64:isNaN(e)&&(i=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(i);return c});AtKit.addFn("utf8_encode",function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",
d=0;d<a.length;d++){var f=a.charCodeAt(d);f<128?c+=String.fromCharCode(f):(f>127&&f<2048?c+=String.fromCharCode(f>>6|192):(c+=String.fromCharCode(f>>12|224),c+=String.fromCharCode(f>>6&63|128)),c+=String.fromCharCode(f&63|128))}return c});AtKit.addFn("sendTTSChunk",function(a){var c=a.block==1?0:400*a.block,c=a.fullData.substring(c,c+400>a.fullData.length?a.fullData.length:c+400),c=e+"xmlhttp/remote.php?rt=tts&v=2&i=1&l="+AtKit.getLanguage()+"&id="+a.reqID+"&data="+c+"&chunkData="+a.totalBlocks+"-"+
a.block;a.block==a.totalBlocks-1&&(c+="&page="+encodeURIComponent(window.location));c+="&callback=?";$lib.getJSON(c,function(d){$lib("#compactStatus").html(a.block+" / "+a.totalBlocks);var c="<h2>"+AtKit.localisation("tts_error")+"</h2>";a.block==a.totalBlocks?(AtKit.show(h.starting),d.status=="encoding"?AtKit.call("countdownTTS",{timeLeft:d.est_completion/d.chunks,id:d.ID}):d.status=="failure"&&d.reason=="overcapacity"?AtKit.message(c+"<p>"+AtKit.localisation("tts_overloaded")+"</p>"):d.status==
"failure"&&d.message===""?AtKit.message(c+"<p>"+AtKit.localisation("tts_problem")+"</p>"):AtKit.message(c+"<p>"+d.reason+" "+d.data.message+"</p>")):d.data.message=="ChunkSaved"?AtKit.call("sendTTSChunk",{fullData:a.fullData,block:a.block+1,totalBlocks:a.totalBlocks,reqID:a.reqID}):AtKit.message(c+"<p>"+AtKit.localisation("tts_servererror")+"</p>")})});AtKit.addFn("countdownTTS",function(a){isNaN(a.timeLeft)?AtKit.message("<h2>"+AtKit.localisation("tts_error")+"</h2> <p>"+AtKit.localisation("tts_problem")+
"</p>"):a.timeLeft==0?($lib.browser!="msie"?($lib("body").append($lib('<div id="flashContent"><OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" width="1" height="1" id="audioe"> <PARAM name=movie value="'+e+'TTS/player/player-licensed.swf"></PARAM> <PARAM name=flashvars value="file='+e+"TTS/cache/"+a.id+'.xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady&id=audioo"><PARAM name=allowscriptaccess value="always" /><embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+
e+'TTS/player/player-licensed.swf" width="1" height="1" allowscriptaccess="always" allowfullscreen="false" flashvars="file='+e+"TTS/cache/"+a.id+'.xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady" name="audioe" /> </OBJECT></div>')),AtKit.call("setupTTSListeners")):($lib("<div />",{id:"flashContent"}).prependTo("body"),swfobject.embedSWF(e+"TTS/player/player-licensed.swf","flashContent","1","1","9.0.0","expressInstall.swf",!1,{flashvars:"file="+e+"TTS/cache/"+a.id+".xml&autostart=true&playlist=bottom&repeat=list&playerready=playerReady&id=audioo",
allowscriptaccess:"always"},{id:"audioo",name:"audioo"},function(){AtKit.call("setupTTSListeners")})),AtKit.hideDialog()):($lib("#sbttstimeremaining").html(a.timeLeft+" seconds"),window.setTimeout(function(){AtKit.call("countdownTTS",{timeLeft:a.timeLeft-1,id:a.id})},1E3))});AtKit.addFn("setupTTSListeners",function(){if(AtKit.get("TTS_Listeners_setup")!=!0)window.playerReady=function(a){AtKit.set("ATAudioPlayerID",a.id);for(b in k.TTSButtons)a=k.TTSButtons[b],AtKit.addButton(b,a.tooltip,a.icon,a.fn);
AtKit.set("TTS_position",0);AtKit.set("TTS_playingItem",0);a=swfobject.getObjectById(a.id);$lib.browser!="msie"&&(a=window.document.audioe);a.addModelListener("STATE","ATBarAudioStateListener");a.addModelListener("TIME","ATBarAudioTimeMonitor");a.addControllerListener("ITEM","ATBarAudioItemMonitor")},window.ATBarAudioTimeMonitor=function(a){AtKit.set("TTS_position",a.position)},window.ATBarAudioItemMonitor=function(a){AtKit.set("TTS_playingItem",a.index)},window.ATBarAudioStateListener=function(a){var c=
a.newstate,a=swfobject.getObjectById(a.id);$lib.browser!="msie"&&(a=window.document.audioe);c=="COMPLETED"&&AtKit.get("TTS_playingItem")+1==a.getPlaylist().length&&AtKit.call("TTSRemoveControlBox");c=="IDLE"||c=="PAUSED"?($lib("#at-lnk-ttsPlay").children("img").attr("src",AtKit.getPluginURL()+"images/control.png"),$lib("#at-btn-tts").children("img").attr("src",AtKit.getPluginURL()+"images/sound.png").css("padding-top","6px")):AtKit.get("TTS_clickEnabled")==!1&&($lib("#at-lnk-ttsPlay").children("img").attr("src",
AtKit.getPluginURL()+"images/control-pause.png"),$lib("#at-btn-tts").children("img").attr("src",AtKit.getPluginURL()+"images/loading.gif").css("padding-top","8px"))},AtKit.set("TTS_Listeners_setup",!0)});AtKit.addFn("TTSRemoveControlBox",function(){AtKit.removeButton("ttsPlay");AtKit.removeButton("ttsRewind");AtKit.removeButton("ttsStop");$lib("#flashContent").remove();$lib("#at-lnk-tts").children("img").attr("src",AtKit.getPluginURL()+"images/sound.png").css("padding-top","6px");AtKit.set("TTS_clickEnabled",
!0)});AtKit.set("TTS_clickEnabled",!0);$lib(document).delegate("#at-btn-tts","mousemove, focus, mouseover",function(){var a=AtKit.call("getSelectedTextTTS");typeof a=="undefined"||a==""||AtKit.set("TTSselectedData",a)});AtKit.addButton("tts",AtKit.localisation("tts_title"),AtKit.getPluginURL()+"images/sound.png",function(a){if(AtKit.set("TTS_clickEnabled")!=!1){var c=AtKit.call("getSelectedTextTTS");AtKit.get("TTSselectedData")==""&&c!=""&&AtKit.set("TTSselectedData",c);AtKit.show(a.options);AtKit.set("TTS_Listeners_setup",
!1);AtKit.addScript(g+"/swfobject.js",null);$lib("#sbStartTTS").click(function(){var a=$lib(document.body).clone();a.find("script, noscript, style, #facebox_overlay, #sbar, #sbarGhost, #facebox, br, img").remove();a=String(a.html()).replace(/<\!---.*---\>/g,"");a.replace(/[\n\r]+/g,"");var a=AtKit.call("b64",a),c=Math.ceil(a.length/400);if(c>0){var e=Math.floor(Math.random()*5001);AtKit.message("<h2>"+AtKit.localisation("tts_pleasewait")+"</h2><p>"+AtKit.localisation("tts_converting")+"...<br /><div id='compactStatus'>0 / "+
c+"</div></p>");AtKit.call("sendTTSChunk",{fullData:a,block:1,totalBlocks:c,reqID:e})}else AtKit.message("<h2>"+AtKit.localisation("tts_error")+"</h2><p>"+AtKit.localisation("tts_problem")+"</p>")});$lib("#sbStartTTSSelection").click(function(){AtKit.set("TTS_clickEnabled",!1);var a=AtKit.get("TTSselectedData");if(a==""||typeof a=="undefined")a=AtKit.call("getSelectedTextTTS");if(typeof a!="undefined"&&a!==""){this.clickEnabled=!1;var a=AtKit.call("b64",a),c=Math.ceil(a.length/400);if(c>0){var e=
Math.floor(Math.random()*5001);AtKit.message("<h2>"+AtKit.localisation("tts_pleasewait")+"</h2><p>"+AtKit.localisation("tts_converting")+"...<br /><div id='compactStatus'>0 / "+c+"</div></p>");AtKit.call("sendTTSChunk",{fullData:a,block:1,totalBlocks:c,reqID:e})}else AtKit.message("<h2>"+AtKit.localisation("tts_error")+"</h2><p>"+AtKit.localisation("tts_problem")+"</p>")}else AtKit.message("<h2>"+AtKit.localisation("tts_title")+"</h2><p>"+AtKit.localisation("tts_explain")+"</p>")})}},h,{},k)};typeof window.AtKit==
"undefined"?(window.AtKitLoaded=function(){var g=null;this.subscribe=function(e){g=e};this.fire=function(e,h){g!==null&&g(e,h)}},window.AtKitLoaded=new AtKitLoaded,window.AtKitLoaded.subscribe(function(){AtKit.registerPlugin("insipio-tts",l)})):AtKit.registerPlugin("insipio-tts",l)})();
