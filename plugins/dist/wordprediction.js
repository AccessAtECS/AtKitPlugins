(function(){var f=function(){$lib=AtKit.lib();var b;AtKit.addLocalisationMap("GB",{wp_title:"Word Prediction",wp_ignore:"Ignore",wp_instruct:"Keystrokes: esc to close, Ctrl + Alt + (1, 2, 3 etc)"});AtKit.addLocalisationMap("ar",{wp_title:"&#1578;&#1588;&#1594;&#1610;&#1604; &#1605;&#1602;&#1578;&#1585;&#1581; &#1575;&#1604;&#1603;&#1604;&#1605;&#1575;&#1578;",wp_ignore:"&#1578;&#1580;&#1575;&#1607;&#1604;",wp_instruct:"&#1605;&#1601;&#1575;&#1578;&#1610;&#1581;: Esc &#1604;&#1604;&#1582;&#1585;&#1608;&#1580;&#1548; Ctrl+Alt+(1,2,3...)"});
AtKit.set("WordPrediction_TextSelected",null);$lib('input[type="text"], textarea').bind("focus",function(){AtKit.set("WordPrediction_TextSelected",$lib(this))});AtKit.addFn("getCaretPos",function(a){var a=a[0],c;if(document.selection&&document.selection.createRange)c=document.selection.createRange().getBookmark().charCodeAt(2)-2;else if(a.setSelectionRange)c=a.selectionStart;return c});AtKit.addFn("setCaretPos",function(a){var c=a.input[0];c!==null&&(c.createTextRange?(c=c.createTextRange(),c.move("character",
a.position),c.select()):c.selectionStart?(c.focus(),c.setSelectionRange(a.position,a.position)):c.focus())});AtKit.addButton("wordprediction",AtKit.localisation("wp_title"),AtKit.getPluginURL()+"images/aitype.png",function(){altModifier=ctrlModifier=!1;$lib('input[type="text"], textarea').bind("keydown",function(a){if(!(a.which==17||a.which==18||ctrlModifier||altModifier)){clearTimeout(b);var c=$lib(this);if(a.keyCode==27)return $lib("#AtKitWordPrediction").remove();b=setTimeout(function(){var a=
AtKit.get("WordPrediction_TextSelected");if(a!==null){var b=a.val(),e=AtKit.call("getCaretPos",a);AtKit.set("WordPrediction_CaretPos",e);var f=b.substring(0,e).split(" ").slice(-6).join(" "),b=b.substring(e).split(" ").slice(0,2).join(" "),e="http://predict.atbar.org/";e+=AtKit.getLanguage()=="ar"?"AR/":"EN/";e+="predict?l="+encodeURIComponent(f)+"&t="+encodeURIComponent(b)+"&callback=?";URL=e;$lib.getJSON(URL,function(b){var b=b.payload.split(";"),e=b.splice(0,2);$lib.each(e,function(a){isNaN(e[a].charAt(0))||
(e[a]=e[a].substring(1))});var d=a.position(),f=a.width(),h=a.outerHeight(),g="",g=$lib("#AtKitWordPrediction").length===0?$lib("<div>",{id:"AtKitWordPrediction"}).css({position:"absolute",left:d.left+"px",width:f,top:5+d.top+h+"px",background:"white","font-size":"16pt","font-weight":"bold",color:"black",border:"2px solid black","z-index":"9999999999",padding:"10px"}):$lib("#AtKitWordPrediction").empty();g.append($lib("<a>",{href:"#",html:AtKit.localisation("wp_ignore"),style:"color:red;padding-right:10px;float:left;"}).bind("click",
function(){$lib("#AtKitWordPrediction").remove();a.focus()}));for(i=0;i<b.length;i++)d=b[i],d!=""&&(d.charAt(0),d=d.substring(1),d=$lib("<a>",{html:d,href:"#",style:"padding-right:10px;float:left;"}).data("suggestion",d).bind("click",function(a){var b=AtKit.get("WordPrediction_CaretPos"),c=$lib(this).data("suggestion")+" ",d=AtKit.get("WordPrediction_TextSelected"),f=b-e[0].length;b+=e[1].length;d.val(d.val().substring(0,f)+c+d.val().substring(b));g.remove();d.focus();AtKit.call("setCaretPos",{input:d,
position:f+c.length});a.preventDefault();return!1}),g.append(d));b=$lib("<p>",{html:AtKit.localisation("wp_instruct"),style:"font-size:12pt; padding-top:10px;clear:left"});g.append(b);a.after(g);c.keyup(function(a){a.keyCode==17&&(ctrlModifier=!1);a.keyCode==18&&(altModifier=!1)}).keydown(function(a){a.keyCode==17&&(ctrlModifier=!0);a.keyCode==18&&(altModifier=!0);offset=48;if(ctrlModifier&&altModifier&&a.keyCode>=49&&a.keyCode<=57)numKey=a.keyCode-offset,altModifier=ctrlModifier=!1,$lib("#AtKitWordPrediction").children("a:eq("+
numKey+")").click(),a.preventDefault?a.preventDefault():a.stop(),a.returnValue=!1,a.stopPropagation(),c.trigger("keydown")})})}},500)}})})};typeof window.AtKit=="undefined"?(window.AtKitLoaded=function(){var b=null;this.subscribe=function(a){b=a};this.fire=function(a,c){b!==null&&b(a,c)}},window.AtKitLoaded=new AtKitLoaded,window.AtKitLoaded.subscribe(function(){AtKit.registerPlugin("wordprediction",f)})):AtKit.registerPlugin("wordprediction",f)})();
